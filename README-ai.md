# понятия

- `!!sgu-app!!` - текущее приложение (плагин для Chrome)
- `!!sgu-config!!` - это конфигурация со всеми пользовательскими данными
- `!!sgu-s-page!!` - это экран где пользователь видит `!sgu-config!`, может изменять и сохранять его
- `!!sgu-pane!!` - это боковая панель браузера, в ней пользователь взаимодействует с основной частью плагина `!sgu-app!`
- `!!sgu-pattern!!` - шаблон строки с плейсхолдерами, по которому генерируется итоговый результат
- `!!sgu-result!!` - итоговая сгенерированная строка (URL или произвольная)

# описание

- текущий плагин предназначен для удобного формирования строки вида URL и просто любых строк
- при нажатии на значок плагина открывается боковая панель браузера (`!sgu-pane!`); если браузер не поддерживает Side Panel API (например, Яндекс Браузер), вместо панели открывается popup
- структура боковой панели:
    - статический заголовок "s485s StrGenUrl"
    - кнопка "Settings"; при нажатии в браузере открывается `!sgu-s-page!`
    - разделитель (горизонтальная линия)
    - область кнопок:
      - кнопка уменьшения размера текстов контента плагина
      - кнопка увеличения размера текстов контента плагина
    - разделитель (горизонтальная линия)
    - : пользовательская часть формируемая на базе поля `projects` из `!sgu-config!`:
        - список блоков:
            - отдельный блок представляющий проект:
                - заголовок, значение берётся из `!sgu-config!.projects.name`
                - подзаголовок, значение берётся из `!sgu-config!.projects.description`
                - область для переменных:
                    - список блоков:
                        - отдельный блок представляющий переменную:
                            - заголовок, значение берётся из `!sgu-config!.projects.envs.name`
                            - подзаголовок, значение берётся из `!sgu-config!.projects.envs.description`
                            - выпадающий список, значения берутся из `!sgu-config!.projects.envs.values`
                - область для паттернов:
                    - список блоков:
                        - отдельный блок представляющий паттерн:
                            - название паттерна из `!sgu-config!.projects.patterns.name`
                            - превью итоговой строки (`!sgu-result!`) — обновляется в реальном времени по мере выбора значений переменных
                            - : область кнопок
                              - кнопка "Copy" — копирует `!sgu-result!` в буфер обмена
                              - кнопка "Open" (только если `type: url`) — открывает `!sgu-result!` в новой вкладке браузера
                            - раскрывающийся блок; текст "Show pattern"; при нажатии ракрывается область в которой отображается содержимое `!sgu-config!.projects.patterns.pattern`; при этом плейсхолдеры выделены цветом

# структура !sgu-s-page!

- статический заголовок "s485s StrGenUrl"
- статический подзаголовок "Edit your configuration in YAML format below."
- блок управления:
    - кнопка "Save":
        - валидирует YAML (синтаксис и структура конфига)
        - при ошибке — показывает сообщение с описанием и местом ошибки
        - при успехе — сохраняет в `chrome.storage.sync` и показывает "Saved!" на 2.5 сек
    - кнопка "Reset to Default":
        - запрашивает подтверждение через `confirm()`
        - при подтверждении — подставляет в редактор встроенный дефолтный конфиг (без сохранения)
    - область кнопок:
      - кнопка уменьшения размера текстов контента плагина
      - кнопка увеличения размера текстов контента плагина
    - область сообщений — отображает результат последней операции (успех или ошибка)
- раскрывающийся блок "Config format reference":
    - содержит краткую шпаргалку по формату конфига (YAML-пример с комментариями)
- YAML-редактор:
    - реализован через технику textarea overlay: прозрачный `<textarea>` поверх `<pre>` с подсвеченным HTML
    - подсветка синтаксиса обновляется в реальном времени по мере ввода
    - клавиша Tab вставляет 2 пробела вместо переключения фокуса
    - скролл `<pre>` синхронизируется со скроллом `<textarea>`
    - по высоте подстраивается под контент
    - блоки проектов (`- name: ...`) можно сворачивать и разворачивать кликом по маркеру `▼`/`▶` слева от строки; свёрнутый блок отображается одной строкой-заглушкой; при сохранении все блоки автоматически разворачиваются

# механика генерации строки

- `!sgu-pattern!` содержит плейсхолдеры вида `{имя_переменной}`, соответствующие `envs.name` из `!sgu-config!`
- при изменении значения в любом выпадающем списке все паттерны проекта мгновенно пересчитываются
- если переменная не имеет выбранного значения — плейсхолдер остаётся как есть или подсвечивается как незаполненный
- тип паттерна (`type`):
    - `url` — итоговая строка трактуется как URL; доступна кнопка "Open"
      - если итоговая строка после замен содержит огрехи, например два слэша, или знак '?' на конце просле которого ничего нет, или подряд несколько символов '&', или символ '&' на конце, и другое, то строка принудтельно "по умному" приводится к правильному виду
    - `str` — произвольная строка; кнопка "Open" недоступна

# хранение конфигурации

- `!sgu-config!` хранится в `chrome.storage.sync` — синхронизируется между устройствами пользователя
- редактирование конфигурации происходит на `!sgu-s-page!` в виде YAML-редактора с подсветкой синтаксиса
- при сохранении конфигурация валидируется; ошибки отображаются пользователю с указанием строки
- изменения применяются мгновенно — `!sgu-pane!` обновляется без перезагрузки

# пример !sgu-config!

```yaml
projects:
  - name: Project Example
    description: super app
    envs:
      - name: "host"
        description: this is host
        values:
          - example.com
          - test.example.com
      - name: "/:subscriptionId"
        values:
          - 1
          - 2
      - name: "qs1"
        values:
          - a=b
          - c=d
      - name: "qs2"
        values:
          - x=y
          - z=w
    patterns:
      - pattern: "https://{host}/base/{/:subscriptionId}?{qs1}&{qs2}"
        type: url
        name: subscriptions page
      - pattern: "{host}/base/{/:subscriptionId}"
        type: str
        name: path only
```

# пример работы

1. пользователь открывает `!sgu-pane!`
2. видит проект "Project Example"
3. в выпадающих списках выбирает:
    - `host` → `test.example.com`
    - `/:subscriptionId` → `2`
    - `qs1` → `a=b`
    - `qs2` → `x=y`
4. паттерн "subscriptions page" мгновенно показывает превью:
   `https://test.example.com/base/2?a=b&x=y`
5. нажимает "Copy" — строка в буфере, или "Open" — строка открывается в браузере

# возможные направления развития (пока не реализуем, может быть сделаем в будущем)

- **история** — сохранение последних N сгенерированных строк на проект
- **избранное** — возможность закрепить часто используемые комбинации значений
- **быстрый поиск** — фильтрация проектов по названию прямо в `!sgu-pane!`
- **импорт/экспорт** — выгрузка и загрузка `!sgu-config!` в виде файла
- **переменные с произвольным вводом** — помимо выпадающего списка, возможность вручную вписать значение
- **группировка проектов** — вложенные группы для удобной организации большого числа проектов
